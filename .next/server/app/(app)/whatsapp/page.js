(()=>{var e={};e.id=438,e.ids=[438],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6021:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>x,pages:()=>d,routeModule:()=>h,tree:()=>c}),s(8185),s(3703),s(5866),s(1506);var a=s(3191),r=s(8716),i=s(7922),n=s.n(i),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["(app)",{children:["whatsapp",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8185)),"/Users/iongonta/Downloads/taxflow-crm/app/(app)/whatsapp/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,3703)),"/Users/iongonta/Downloads/taxflow-crm/app/(app)/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,1506)),"/Users/iongonta/Downloads/taxflow-crm/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/iongonta/Downloads/taxflow-crm/app/(app)/whatsapp/page.tsx"],x="/(app)/whatsapp/page",p={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(app)/whatsapp/page",pathname:"/whatsapp",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6257:(e,t,s)=>{Promise.resolve().then(s.bind(s,1402))},5029:(e,t,s)=>{Promise.resolve().then(s.bind(s,5999))},4315:(e,t,s)=>{Promise.resolve().then(s.bind(s,2899))},3324:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},1402:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(326),r=s(7577),i=s(5047),n=s(2945),l=s(5999),o=s(1405),c=s(8307),d=s(9730);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,s(2881).Z)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var p=s(9436);let h={Nou:"#94a3b8",Contactat:"#3a7bd5","\xcent\xe2lnire programată":"#c9a84c","Ofertă trimisă":"#8b5cf6","Client activ":"#00c48c",Pierdut:"#e05050"};function m(){let[e,t]=(0,r.useState)([]),[s,m]=(0,r.useState)([]),[u,f]=(0,r.useState)(null),[g,v]=(0,r.useState)([]),[b,w]=(0,r.useState)(""),[j,y]=(0,r.useState)(""),[N,_]=(0,r.useState)(!1),[P,k]=(0,r.useState)(!0),[S,A]=(0,r.useState)(!1),C=(0,r.useRef)(null);(0,i.useSearchParams)();let U=(0,n.e)();async function Z(){let{data:e}=await U.from("whatsapp_conversations").select("*, lead:lead_id(name, status)").order("last_message_at",{ascending:!1});t(e||[]),m(e||[]),k(!1)}async function q(e){A(!0);let{data:s}=await U.from("whatsapp_messages").select("*").eq("conversation_id",e).order("created_at",{ascending:!0});v(s||[]),A(!1),await U.from("whatsapp_conversations").update({unread_count:0}).eq("id",e),t(t=>t.map(t=>t.id===e?{...t,unread_count:0}:t))}async function D(e){f(e),v([]),y(""),await q(e.id)}async function E(){if(j.trim()&&u&&!N){_(!0);try{let e=await fetch("/api/whatsapp/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:u.id,message:j.trim()})}),t=await e.json();if(!e.ok)throw Error(t.error);y("")}catch(e){l.A.error(e.message)}finally{_(!1)}}}let M=e.reduce((e,t)=>e+(t.unread_count||0),0);return(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,a.jsxs)("div",{className:"w-80 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("h1",{className:"text-sm font-semibold",children:"WhatsApp"}),M>0&&a.jsx("span",{className:"bg-[#00c48c] text-white text-[10px] font-bold px-2 py-0.5 rounded-full",children:M})]}),a.jsx("button",{onClick:Z,className:"text-gray-400 hover:text-[#004437] transition-colors",children:a.jsx(o.Z,{size:14})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 border border-gray-200 rounded-lg px-3 py-1.5",children:[a.jsx(c.Z,{size:13,className:"text-gray-400"}),a.jsx("input",{className:"bg-transparent text-sm outline-none flex-1 placeholder:text-gray-400",placeholder:"Caută conversație...",value:b,onChange:e=>w(e.target.value)})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:P?a.jsx("div",{className:"flex items-center justify-center h-32 text-gray-400 text-sm",children:"Se \xeencarcă..."}):0===s.length?(0,a.jsxs)("div",{className:"text-center py-16 px-4",children:[a.jsx(d.Z,{size:32,className:"mx-auto text-gray-300 mb-3"}),a.jsx("p",{className:"text-sm text-gray-400 font-medium",children:"Nicio conversație"}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Mesajele de pe WhatsApp Business vor apărea automat aici"})]}):s.map(e=>{let t=(e.wa_name||e.wa_phone).substring(0,2).toUpperCase(),s=u?.id===e.id,r=e.lead?.status?h[e.lead.status]:"#94a3b8";return a.jsx("div",{onClick:()=>D(e),className:`px-4 py-3 cursor-pointer border-b border-gray-100 transition-colors ${s?"bg-[#e8f0ee]":"hover:bg-gray-50"}`,children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsxs)("div",{className:"relative flex-shrink-0",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-[#25d366] flex items-center justify-center text-white text-xs font-bold",children:t}),e.unread_count>0&&a.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-[#00c48c] rounded-full flex items-center justify-center text-[9px] font-bold text-white",children:e.unread_count>9?"9+":e.unread_count})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[a.jsx("span",{className:"text-sm font-semibold text-gray-900 truncate",children:e.wa_name||e.wa_phone}),a.jsx("span",{className:"text-[10px] text-gray-400 flex-shrink-0",children:e.last_message_at?function(e){let t=new Date(e),s=new Date,a=s.getTime()-t.getTime();return a<6e4?"acum":a<36e5?Math.floor(a/6e4)+"m":t.toDateString()===s.toDateString()?t.toLocaleTimeString("ro-RO",{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString("ro-RO",{day:"2-digit",month:"short"})}(e.last_message_at):""})]}),e.lead&&(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-0.5",children:[a.jsx("span",{className:"w-1.5 h-1.5 rounded-full flex-shrink-0",style:{background:r}}),a.jsx("span",{className:"text-[10px] text-gray-500 truncate",children:e.lead.name})]}),a.jsx("p",{className:"text-xs text-gray-400 truncate",children:e.last_message||"—"})]})]})},e.id)})})]}),u?(0,a.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 h-14 flex items-center justify-between flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-[#25d366] flex items-center justify-center text-white text-xs font-bold",children:(u.wa_name||u.wa_phone).substring(0,2).toUpperCase()}),(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-sm font-semibold text-gray-900",children:u.wa_name||u.wa_phone}),(0,a.jsxs)("div",{className:"text-xs text-gray-400",children:["+",u.wa_phone]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[u.lead_id&&(0,a.jsxs)("a",{href:"/contacts",className:"flex items-center gap-1.5 text-xs text-[#004437] border border-[#c2d9d3] px-3 py-1.5 rounded-lg hover:bg-[#e8f0ee] transition-colors",children:[a.jsx(x,{size:12}),"Vezi fișa contact"]}),(0,a.jsxs)("a",{href:`https://wa.me/${u.wa_phone}`,target:"_blank",className:"flex items-center gap-1.5 text-xs text-green-700 border border-green-200 px-3 py-1.5 rounded-lg hover:bg-green-50 transition-colors",children:[a.jsx(d.Z,{size:12}),"Deschide WA"]})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 bg-[#f0f2f5]",children:[S?a.jsx("div",{className:"flex items-center justify-center h-32 text-gray-400 text-sm",children:"Se \xeencarcă mesajele..."}):0===g.length?a.jsx("div",{className:"flex items-center justify-center h-32 text-gray-400 text-sm",children:"Niciun mesaj \xeencă"}):g.map(e=>{let t="outbound"===e.direction;return a.jsx("div",{className:`flex ${t?"justify-end":"justify-start"}`,children:(0,a.jsxs)("div",{className:`max-w-xs lg:max-w-md xl:max-w-lg rounded-2xl px-4 py-2.5 shadow-sm ${t?"bg-[#004437] text-white rounded-br-sm":"bg-white text-gray-900 rounded-bl-sm"}`,children:[a.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.body}),(0,a.jsxs)("div",{className:`flex items-center gap-1 mt-1 ${t?"justify-end":"justify-start"}`,children:[a.jsx("span",{className:`text-[10px] ${t?"text-white/60":"text-gray-400"}`,children:new Date(e.created_at).toLocaleTimeString("ro-RO",{hour:"2-digit",minute:"2-digit"})}),t&&a.jsx("span",{className:"text-[10px] text-white/60",children:"read"===e.status?"✓✓":"delivered"===e.status?"✓✓":"✓"})]})]})},e.id)}),a.jsx("div",{ref:C})]}),(0,a.jsxs)("div",{className:"bg-white border-t border-gray-200 px-4 py-3 flex items-end gap-3",children:[a.jsx("textarea",{className:"flex-1 resize-none border border-gray-200 rounded-xl px-4 py-2.5 text-sm outline-none focus:border-[#004437] transition-colors max-h-32 min-h-[44px]",placeholder:"Scrie un mesaj...",value:j,onChange:e=>y(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E())},rows:1}),a.jsx("button",{onClick:E,disabled:!j.trim()||N,className:"w-11 h-11 bg-[#004437] text-white rounded-xl flex items-center justify-center hover:bg-[#005a47] transition-colors disabled:opacity-40 disabled:cursor-not-allowed flex-shrink-0",children:N?a.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):a.jsx(p.Z,{size:16})})]})]}):a.jsx("div",{className:"flex-1 flex items-center justify-center bg-[#f0f2f5]",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"w-16 h-16 bg-[#e8f0ee] rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(d.Z,{size:28,className:"text-[#004437]"})}),a.jsx("h3",{className:"text-base font-semibold text-gray-700 mb-1",children:"TaxFlow WhatsApp"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Selectează o conversație pentru a citi mesajele"})]})})]})}},2899:(e,t,s)=>{"use strict";s.d(t,{default:()=>w});var a=s(326),r=s(434),i=s(5047),n=s(2945),l=s(4319),o=s(3468),c=s(4061),d=s(1383),x=s(7358),p=s(9730),h=s(3685),m=s(763),u=s(1810),f=s(5999),g=s(1135);let v=[{label:"Dashboard",href:"/dashboard",icon:l.Z},{label:"Pipeline",href:"/pipeline",icon:o.Z},{label:"Contacte",href:"/contacts",icon:c.Z},{label:"Sarcini",href:"/tasks",icon:d.Z},{label:"Evenimente",href:"/events",icon:x.Z},{label:"WhatsApp",href:"/whatsapp",icon:p.Z},{label:"Import",href:"/import",icon:h.Z}],b=[{label:"Echipă & Utilizatori",href:"/admin/users",icon:m.Z}];function w({profile:e}){let t=(0,i.usePathname)(),s=(0,i.useRouter)(),r="admin"===e.role,l=e.full_name.split(" ").map(e=>e[0]).join("").substring(0,2).toUpperCase();async function o(){let e=(0,n.e)();await e.auth.signOut(),f.A.success("La revedere!"),s.push("/auth/login"),s.refresh()}return r&&[...v,...b],(0,a.jsxs)("aside",{className:"w-[220px] min-w-[220px] bg-[#002e25] flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"px-5 py-5 border-b border-white/[0.08]",children:[a.jsx("div",{className:"font-serif text-xl text-white tracking-tight",children:"TaxFlow"}),a.jsx("div",{className:"text-[10px] text-white/40 uppercase tracking-[1.5px] mt-0.5",children:"CRM \xb7 Partner financiar"})]}),(0,a.jsxs)("nav",{className:"flex-1 px-2.5 py-4 overflow-y-auto scrollbar-thin space-y-0.5",children:[a.jsx("p",{className:"text-[10px] uppercase tracking-[1.2px] text-white/30 font-medium px-2.5 py-2",children:"Principal"}),v.slice(0,3).map(e=>a.jsx(j,{...e,active:t.startsWith(e.href)},e.href)),a.jsx("p",{className:"text-[10px] uppercase tracking-[1.2px] text-white/30 font-medium px-2.5 py-2 mt-2",children:"Activitate"}),v.slice(3,5).map(e=>a.jsx(j,{...e,active:t.startsWith(e.href)},e.href)),a.jsx("p",{className:"text-[10px] uppercase tracking-[1.2px] text-white/30 font-medium px-2.5 py-2 mt-2",children:"Instrumente"}),v.slice(5).map(e=>a.jsx(j,{...e,active:t.startsWith(e.href)},e.href)),r&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("p",{className:"text-[10px] uppercase tracking-[1.2px] text-white/30 font-medium px-2.5 py-2 mt-2",children:"Administrare"}),b.map(e=>a.jsx(j,{...e,active:t.startsWith(e.href)},e.href))]})]}),(0,a.jsxs)("div",{className:"px-4 py-3.5 border-t border-white/[0.08] flex items-center gap-2.5",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white flex-shrink-0",style:{background:e.avatar_color},children:l}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-[13px] text-white font-medium truncate",children:e.full_name}),a.jsx("div",{className:"text-[11px] text-white/40 truncate",children:r?"⚡ Administrator":"Utilizator"})]}),a.jsx("div",{className:"flex items-center gap-1",children:a.jsx("button",{onClick:o,className:"text-white/40 hover:text-white/80 transition-colors p-1",title:"Ieșire",children:a.jsx(u.Z,{size:15})})})]})]})}function j({href:e,label:t,icon:s,active:i}){return(0,a.jsxs)(r.default,{href:e,className:(0,g.Z)("flex items-center gap-2.5 px-2.5 py-2 rounded-lg text-[13.5px] transition-all",i?"bg-[#00c48c]/15 text-[#00c48c] font-medium":"text-white/60 hover:bg-white/[0.07] hover:text-white"),children:[a.jsx(s,{size:16,className:"flex-shrink-0"}),t]})}},2945:(e,t,s)=>{"use strict";s.d(t,{e:()=>r});var a=s(861);function r(){return(0,a.createBrowserClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}},1405:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2881).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8307:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2881).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},9436:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2881).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},3703:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(9510),r=s(8585),i=s(9692),n=s(8570);let l=(0,n.createProxy)(String.raw`/Users/iongonta/Downloads/taxflow-crm/components/layout/Sidebar.tsx`),{__esModule:o,$$typeof:c}=l;l.default;let d=(0,n.createProxy)(String.raw`/Users/iongonta/Downloads/taxflow-crm/components/layout/Sidebar.tsx#default`);async function x({children:e}){let t=(0,i.e)(),{data:{user:s}}=await t.auth.getUser();s||(0,r.redirect)("/auth/login");let{data:n}=await t.from("profiles").select("id, full_name, email, role, is_active, avatar_color").eq("id",s.id).single();return n?.is_active||(0,r.redirect)("/auth/login?error=account_disabled"),(0,a.jsxs)("div",{className:"flex h-screen overflow-hidden bg-gray-50",children:[a.jsx(d,{profile:n}),a.jsx("main",{className:"flex-1 flex flex-col overflow-hidden",children:e})]})}},8185:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>i,default:()=>l});var a=s(8570);let r=(0,a.createProxy)(String.raw`/Users/iongonta/Downloads/taxflow-crm/app/(app)/whatsapp/page.tsx`),{__esModule:i,$$typeof:n}=r;r.default;let l=(0,a.createProxy)(String.raw`/Users/iongonta/Downloads/taxflow-crm/app/(app)/whatsapp/page.tsx#default`)},1506:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,metadata:()=>i});var a=s(9510),r=s(1032);s(7272);let i={title:"TaxFlow CRM",description:"Partner \xeen structurare financiară"};function n({children:e}){return(0,a.jsxs)("html",{lang:"ro",children:[(0,a.jsxs)("head",{children:[a.jsx("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),a.jsx("link",{href:"https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&family=DM+Serif+Display:ital@0;1&display=swap",rel:"stylesheet"})]}),(0,a.jsxs)("body",{className:"bg-gray-50 text-gray-900 antialiased",children:[e,a.jsx(r.x7,{position:"bottom-right",richColors:!0})]})]})}},9692:(e,t,s)=>{"use strict";s.d(t,{e:()=>i});var a=s(7721),r=s(1615);function i(){let e=(0,r.cookies)();return(0,a.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:s,options:a})=>e.set(t,s,a))}catch{}}}})}},7272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,786,702,172,334,748],()=>s(6021));module.exports=a})();