"use strict";(()=>{var e={};e.id=315,e.ids=[315],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2799:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var a={};r.r(a),r.d(a,{POST:()=>p});var s=r(9303),n=r(8716),i=r(670),o=r(7070),u=r(7857);async function p(e){try{let{token:t,email:r,password:a,fullName:s,role:n}=await e.json();if(!t||!r||!a||!s)return o.NextResponse.json({error:"Date incomplete"},{status:400});let i=(0,u.eI)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),{data:p,error:c}=await i.from("invitations").select("id, email, accepted_at, expires_at").eq("token",t).single();if(c||!p)return o.NextResponse.json({error:"Token invalid"},{status:400});if(p.accepted_at)return o.NextResponse.json({error:"Invitație deja folosită"},{status:400});if(new Date(p.expires_at)<new Date)return o.NextResponse.json({error:"Invitație expirată"},{status:400});if(p.email!==r)return o.NextResponse.json({error:"Email nepotrivit"},{status:400});let{data:d,error:l}=await i.auth.admin.createUser({email:r,password:a,email_confirm:!0,user_metadata:{full_name:s,role:n||"user"}});if(l){if(l.message.includes("already registered"))return o.NextResponse.json({error:"Există deja un cont cu acest email"},{status:409});return o.NextResponse.json({error:l.message},{status:500})}return await i.from("invitations").update({accepted_at:new Date().toISOString()}).eq("token",t),d.user&&await i.from("profiles").update({role:n||"user",full_name:s}).eq("id",d.user.id),o.NextResponse.json({success:!0,userId:d.user?.id})}catch(e){return console.error("accept-invite error:",e),o.NextResponse.json({error:e.message||"Eroare server"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/accept-invite/route",pathname:"/api/auth/accept-invite",filename:"route",bundlePath:"app/api/auth/accept-invite/route"},resolvedPagePath:"/Users/iongonta/Downloads/taxflow-crm/app/api/auth/accept-invite/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:m}=c,v="/api/auth/accept-invite/route";function x(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,786,972],()=>r(2799));module.exports=a})();