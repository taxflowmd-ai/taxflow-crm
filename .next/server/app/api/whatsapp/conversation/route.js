"use strict";(()=>{var e={};e.id=155,e.ids=[155],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},897:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>w,patchFetch:()=>m,requestAsyncStorage:()=>x,routeModule:()=>v,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var a={};s.r(a),s.d(a,{POST:()=>d});var n=s(9303),r=s(8716),o=s(670),i=s(7070),p=s(7721),c=s(1615),u=s(7857);let l=()=>(0,u.eI)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});async function d(e){let{data:{user:t}}=await (function(){let e=(0,c.cookies)();return(0,p.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{getAll:()=>e.getAll(),setAll(){}}})})().auth.getUser();if(!t)return i.NextResponse.json({error:"Neautentificat"},{status:401});let{leadId:s,phone:a,name:n}=await e.json();if(!a)return i.NextResponse.json({error:"Telefon lipsÄƒ"},{status:400});let r=l(),o=a.replace(/\D/g,""),{data:u}=await r.from("whatsapp_conversations").select("id").eq("wa_phone",o).single();if(u)return s&&await r.from("whatsapp_conversations").update({lead_id:s,wa_name:n}).eq("id",u.id),i.NextResponse.json({conversationId:u.id});let{data:d,error:v}=await r.from("whatsapp_conversations").insert({wa_phone:o,wa_name:n||o,lead_id:s||null,unread_count:0}).select().single();return v?i.NextResponse.json({error:v.message},{status:500}):i.NextResponse.json({conversationId:d.id})}let v=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/whatsapp/conversation/route",pathname:"/api/whatsapp/conversation",filename:"route",bundlePath:"app/api/whatsapp/conversation/route"},resolvedPagePath:"/Users/iongonta/Downloads/taxflow-crm/app/api/whatsapp/conversation/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:_,serverHooks:h}=v,w="/api/whatsapp/conversation/route";function m(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,786,702,972],()=>s(897));module.exports=a})();