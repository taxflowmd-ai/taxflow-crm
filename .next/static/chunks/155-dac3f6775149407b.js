"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[155],{3672:function(e,t,a){a.d(t,{Z:function(){return w}});var s=a(7437),l=a(2265),n=a(6474),r=a(7776),i=a(7583),c=a(8030);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,c.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),o=(0,c.Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var u=a(2022);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let h=(0,c.Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);var x=a(4086);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,c.Z)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);var p=a(4241);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,c.Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);var v=a(883);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let y=(0,c.Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var g=a(933),j=a(6463);let b=["Nou","Contactat","\xcent\xe2lnire programată","Ofertă trimisă","Client activ","Pierdut"],N=["Meta Ads","WhatsApp","Organic","Referință","Site web","Import"],k={Nou:"#94a3b8",Contactat:"#3a7bd5","\xcent\xe2lnire programată":"#c9a84c","Ofertă trimisă":"#8b5cf6","Client activ":"#00c48c",Pierdut:"#e05050"};function w(e){var t,a;let{leadId:c,onClose:w,team:_=[],isAdmin:C=!1}=e,M=(0,j.useRouter)(),[Z,z]=(0,l.useState)(null),[S,A]=(0,l.useState)([]),[P,E]=(0,l.useState)(!0),[H,R]=(0,l.useState)(!1),[T,D]=(0,l.useState)(""),[L,q]=(0,l.useState)("info"),[O,U]=(0,l.useState)({}),[I,B]=(0,l.useState)(!1);async function V(e){let t=(0,n.e)(),{data:a}=await t.from("leads").select("*, assignee:assigned_to(id, full_name, avatar_color)").eq("id",e).single(),{data:s}=await t.from("lead_history").select("*, author:created_by(full_name, avatar_color)").eq("lead_id",e).order("created_at",{ascending:!1});z(a),A(s||[]),U({name:(null==a?void 0:a.name)||"",company:(null==a?void 0:a.company)||"",phone:(null==a?void 0:a.phone)||"",email:(null==a?void 0:a.email)||"",source:(null==a?void 0:a.source)||"Meta Ads",status:(null==a?void 0:a.status)||"Nou",assigned_to:(null==a?void 0:a.assigned_to)||"",note:(null==a?void 0:a.note)||"",reminder_at:(null==a?void 0:a.reminder_at)?a.reminder_at.slice(0,16):""}),E(!1)}async function F(){if(c){R(!0);try{let e=await fetch("/api/leads/".concat(c),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...O,reminder_at:O.reminder_at||null,assigned_to:O.assigned_to||null})}),t=await e.json();if(!e.ok)throw Error(t.error);r.A.success("Contact salvat"),z({...Z,...O}),M.refresh()}catch(e){r.A.error(e.message)}finally{R(!1)}}}async function X(){if(!T.trim()||!c)return;let e=(0,n.e)(),{data:{user:t}}=await e.auth.getUser();await e.from("lead_history").insert({lead_id:c,type:"note",content:T.trim(),created_by:null==t?void 0:t.id}),r.A.success("Notă adăugată"),D(""),V(c),q("history")}async function J(){c&&((await fetch("/api/leads/".concat(c),{method:"DELETE"})).ok?(r.A.success("Contact șters"),w(),M.refresh()):r.A.error("Eroare la ștergere"))}async function W(){if(!(null==Z?void 0:Z.phone)){r.A.error("Niciun număr de telefon");return}try{let e=await fetch("/api/whatsapp/conversation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leadId:c,phone:Z.phone,name:Z.name})}),t=await e.json();if(!e.ok)throw Error(t.error);w(),M.push("/whatsapp?conv=".concat(t.conversationId))}catch(e){r.A.error(e.message)}}(0,l.useEffect)(()=>{c&&(E(!0),q("info"),B(!1),V(c))},[c]);let K=e=>({value:O[e]||"",onChange:t=>U(a=>({...a,[e]:t.target.value})),className:"input"});if(!c)return null;let Y=k[null==Z?void 0:Z.status]||"#94a3b8",G=(null==Z?void 0:null===(t=Z.name)||void 0===t?void 0:t.split(" ").map(e=>e[0]).join("").substring(0,2).toUpperCase())||"??";return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:w}),(0,s.jsxs)("div",{className:"fixed right-0 top-0 h-full w-[480px] bg-white shadow-2xl z-50 flex flex-col",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between flex-shrink-0",children:[P?(0,s.jsx)("div",{className:"h-5 w-40 bg-gray-200 rounded animate-pulse"}):(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0",style:{background:(null==Z?void 0:null===(a=Z.assignee)||void 0===a?void 0:a.avatar_color)||"#3a7bd5"},children:G}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-semibold text-gray-900 text-sm",children:null==Z?void 0:Z.name}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5 mt-0.5",children:[(0,s.jsx)("span",{className:"w-1.5 h-1.5 rounded-full",style:{background:Y}}),(0,s.jsx)("span",{className:"text-xs",style:{color:Y},children:null==Z?void 0:Z.status})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(null==Z?void 0:Z.phone)&&(0,s.jsx)("button",{onClick:W,className:"w-8 h-8 rounded-lg border border-green-200 flex items-center justify-center text-green-600 hover:bg-green-50 transition-colors",title:"Deschide \xeen WhatsApp CRM",children:(0,s.jsx)(i.Z,{size:15})}),(null==Z?void 0:Z.phone)&&(0,s.jsx)("a",{href:"tel:".concat(Z.phone),className:"w-8 h-8 rounded-lg border border-gray-200 flex items-center justify-center text-gray-500 hover:bg-gray-50 transition-colors",children:(0,s.jsx)(d,{size:15})}),(0,s.jsx)("button",{onClick:w,className:"w-8 h-8 rounded-lg border border-gray-200 flex items-center justify-center text-gray-400 hover:bg-gray-50 transition-colors",children:(0,s.jsx)(o,{size:15})})]})]}),(0,s.jsx)("div",{className:"px-6 border-b border-gray-200 flex gap-1 flex-shrink-0",children:[{id:"info",label:"Informații"},{id:"note",label:"Adaugă notă"},{id:"history",label:"Istoric (".concat(S.length,")")}].map(e=>(0,s.jsx)("button",{onClick:()=>q(e.id),className:"px-3 py-2.5 text-xs font-medium border-b-2 transition-colors ".concat(L===e.id?"border-[#004437] text-[#004437]":"border-transparent text-gray-500 hover:text-gray-700"),children:e.label},e.id))}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:P?(0,s.jsx)("div",{className:"p-6 space-y-3",children:[1,2,3,4].map(e=>(0,s.jsx)("div",{className:"h-10 bg-gray-100 rounded animate-pulse"},e))}):(0,s.jsxs)(s.Fragment,{children:["info"===L&&(0,s.jsxs)("div",{className:"p-6 space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsxs)("label",{className:"label flex items-center gap-1.5",children:[(0,s.jsx)(u.Z,{size:12}),"Nume complet *"]}),(0,s.jsx)("input",{...K("name"),placeholder:"Ion Popescu"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"label flex items-center gap-1.5",children:[(0,s.jsx)(h,{size:12}),"Companie"]}),(0,s.jsx)("input",{...K("company"),placeholder:"SRL..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"label flex items-center gap-1.5",children:[(0,s.jsx)(d,{size:12}),"Telefon"]}),(0,s.jsx)("input",{...K("phone"),placeholder:"+373..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"label flex items-center gap-1.5",children:[(0,s.jsx)(x.Z,{size:12}),"Email"]}),(0,s.jsx)("input",{...K("email"),type:"email",placeholder:"ion@firma.md"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"label flex items-center gap-1.5",children:[(0,s.jsx)(m,{size:12}),"Sursă"]}),(0,s.jsx)("select",{...K("source"),className:"input",children:N.map(e=>(0,s.jsx)("option",{children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Status"}),(0,s.jsx)("select",{...K("status"),className:"input",children:b.map(e=>(0,s.jsx)("option",{children:e},e))})]}),C&&_.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"label flex items-center gap-1.5",children:[(0,s.jsx)(u.Z,{size:12}),"Responsabil"]}),(0,s.jsxs)("select",{...K("assigned_to"),className:"input",children:[(0,s.jsx)("option",{value:"",children:"— nealocate —"}),_.map(e=>(0,s.jsx)("option",{value:e.id,children:e.full_name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"label flex items-center gap-1.5",children:[(0,s.jsx)(p.Z,{size:12}),"\uD83D\uDD14 Reminder"]}),(0,s.jsx)("input",{...K("reminder_at"),type:"datetime-local",className:"input"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"label flex items-center gap-1.5",children:[(0,s.jsx)(f,{size:12}),"Notă generală"]}),(0,s.jsx)("textarea",{...K("note"),className:"input resize-none",rows:3,placeholder:"Context, servicii dorite..."})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[I?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs text-red-600 font-medium",children:"Ești sigur?"}),(0,s.jsx)("button",{onClick:J,className:"text-xs bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600",children:"Da, șterge"}),(0,s.jsx)("button",{onClick:()=>B(!1),className:"text-xs border border-gray-200 px-3 py-1 rounded-lg hover:bg-gray-50",children:"Anulează"})]}):(0,s.jsxs)("button",{onClick:()=>B(!0),className:"flex items-center gap-1.5 text-xs text-red-500 hover:text-red-700 transition-colors",children:[(0,s.jsx)(v.Z,{size:13}),"Șterge contact"]}),(0,s.jsxs)("button",{onClick:F,disabled:H,className:"btn-primary flex items-center gap-1.5 text-sm",children:[(0,s.jsx)(y,{size:14}),H?"Se salvează...":"Salvează"]})]})]}),"note"===L&&(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("label",{className:"label",children:"Notă nouă"}),(0,s.jsx)("textarea",{className:"input resize-none w-full",rows:5,placeholder:"Scrie ce s-a discutat, ce urmează...",value:T,onChange:e=>D(e.target.value),autoFocus:!0}),(0,s.jsx)("div",{className:"flex justify-end mt-3",children:(0,s.jsx)("button",{onClick:X,disabled:!T.trim(),className:"btn-primary",children:"Adaugă notă"})})]}),"history"===L&&(0,s.jsx)("div",{className:"p-4 space-y-3",children:0===S.length?(0,s.jsxs)("div",{className:"text-center py-12 text-gray-400",children:[(0,s.jsx)(g.Z,{size:28,className:"mx-auto mb-2 opacity-40"}),(0,s.jsx)("p",{className:"text-sm",children:"Niciun istoric"})]}):S.map(e=>{var t,a,l,n;return(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-bold text-white flex-shrink-0 mt-0.5",style:{background:(null===(t=e.author)||void 0===t?void 0:t.avatar_color)||"#94a3b8"},children:(null===(l=e.author)||void 0===l?void 0:null===(a=l.full_name)||void 0===a?void 0:a.split(" ").map(e=>e[0]).join("").substring(0,2))||"?"}),(0,s.jsxs)("div",{className:"flex-1 bg-gray-50 rounded-xl px-3 py-2.5",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-gray-700",children:(null===(n=e.author)||void 0===n?void 0:n.full_name)||"Sistem"}),(0,s.jsx)("span",{className:"text-[10px] text-gray-400",children:new Date(e.created_at).toLocaleDateString("ro-RO",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})})]}),(0,s.jsx)("p",{className:"text-xs text-gray-600 leading-relaxed",children:e.content})]})]},e.id)})})]})})]})]})}},6474:function(e,t,a){a.d(t,{e:function(){return n}});var s=a(6038),l=a(357);function n(){return(0,s.createBrowserClient)(l.env.NEXT_PUBLIC_SUPABASE_URL,l.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}},4241:function(e,t,a){a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(8030).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},933:function(e,t,a){a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(8030).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},4086:function(e,t,a){a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(8030).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},7583:function(e,t,a){a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(8030).Z)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},2513:function(e,t,a){a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(8030).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},883:function(e,t,a){a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(8030).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},2022:function(e,t,a){a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(8030).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},6463:function(e,t,a){var s=a(1169);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}}]);