(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[624],{7326:function(e,a,s){Promise.resolve().then(s.bind(s,7613))},7613:function(e,a,s){"use strict";s.d(a,{default:function(){return m}});var t=s(7437),l=s(2265),r=s(6463),n=s(6474),i=s(7776),d=s(2513),c=s(3672);let o=["Nou","Contactat","\xcent\xe2lnire programată","Ofertă trimisă","Client activ","Pierdut"],x={Nou:"#94a3b8",Contactat:"#3a7bd5","\xcent\xe2lnire programată":"#c9a84c","Ofertă trimisă":"#8b5cf6","Client activ":"#00c48c",Pierdut:"#e05050"},u={"Meta Ads":"bg-blue-100 text-blue-700",WhatsApp:"bg-green-100 text-green-700",Organic:"bg-emerald-100 text-emerald-700",Referință:"bg-purple-100 text-purple-700","Site web":"bg-sky-100 text-sky-700",Import:"bg-gray-100 text-gray-600"};function m(e){let{leads:a,team:s,isAdmin:m,currentUserId:h}=e,p=(0,r.useRouter)(),[b,g]=(0,l.useState)("all"),[f,j]=(0,l.useState)(!1),[y,N]=(0,l.useState)(null),[v,w]=(0,l.useState)(null),[D,_]=(0,l.useState)({name:"",company:"",phone:"",email:"",source:"Meta Ads",status:"Nou",assigned_to:"",note:"",reminder_at:""}),k=a.filter(e=>{var a;return"all"===b||(null===(a=e.assignee)||void 0===a?void 0:a.id)===b});async function C(e,a){let s=(0,n.e)();await s.from("leads").update({status:e}).eq("id",a),i.A.success("→ "+e),p.refresh()}async function A(e){e.preventDefault();let a=(0,n.e)(),{data:{user:s}}=await a.auth.getUser(),t={name:D.name,company:D.company||null,phone:D.phone||null,email:D.email||null,source:D.source,status:D.status,note:D.note||null,reminder_at:D.reminder_at||null,assigned_to:D.assigned_to||(null==s?void 0:s.id),created_by:null==s?void 0:s.id},{error:l}=await a.from("leads").insert(t);if(l){i.A.error(l.message);return}i.A.success("Lead adăugat: "+D.name),j(!1),_({name:"",company:"",phone:"",email:"",source:"Meta Ads",status:"Nou",assigned_to:"",note:"",reminder_at:""}),p.refresh()}let S=e=>({value:D[e],onChange:a=>_(s=>({...s,[e]:a.target.value})),className:"input"});return(0,t.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 h-14 flex items-center justify-between flex-shrink-0",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-base font-semibold",children:"Pipeline Kanban"}),(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:[a.length," lead-uri"]})]}),(0,t.jsxs)("button",{onClick:()=>j(!0),className:"btn-primary",children:[(0,t.jsx)(d.Z,{size:15}),"Lead nou"]})]}),m&&(0,t.jsxs)("div",{className:"bg-white border-b border-gray-100 px-6 py-2 flex items-center gap-2 flex-shrink-0",children:[(0,t.jsx)("span",{className:"text-xs text-gray-500 font-medium",children:"Responsabil:"}),[{id:"all",full_name:"Toți",avatar_color:"#004437"},...s].map(e=>(0,t.jsx)("button",{onClick:()=>g(e.id),className:"px-3 py-1 rounded-full text-xs font-medium border transition-all ".concat(b===e.id?"bg-[#004437] text-white border-[#004437]":"border-gray-200 text-gray-600 hover:border-gray-400"),children:e.full_name},e.id))]}),(0,t.jsx)("div",{className:"flex-1 overflow-x-auto p-6",children:(0,t.jsx)("div",{className:"flex gap-4 h-full min-w-max items-start",children:o.map(e=>{let a=k.filter(a=>a.status===e),s=x[e];return(0,t.jsxs)("div",{className:"w-60 flex flex-col bg-gray-50 border border-gray-200 rounded-xl max-h-[calc(100vh-220px)]",onDragOver:e=>e.preventDefault(),onDrop:a=>{a.preventDefault(),y&&C(e,y)},children:[(0,t.jsxs)("div",{className:"px-3 py-2.5 border-b border-gray-200 flex items-center gap-2 flex-shrink-0",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{background:s}}),(0,t.jsx)("span",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wide flex-1",children:e}),(0,t.jsx)("span",{className:"text-xs font-semibold bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full",children:a.length})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:[a.map(e=>(0,t.jsxs)("div",{draggable:!0,onDragStart:()=>N(e.id),onDragEnd:()=>N(null),className:"bg-white border border-gray-200 rounded-lg p-3 cursor-grab shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all",onClick:a=>{y||w(e.id)},children:[(0,t.jsx)("span",{className:"text-[10px] font-semibold px-2 py-0.5 rounded-full ".concat(u[e.source]||"bg-gray-100 text-gray-600"),children:e.source}),(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900 mt-1.5 mb-0.5",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mb-2",children:e.company||"—"}),e.reminder_at&&(0,t.jsxs)("div",{className:"text-[10px] bg-amber-50 text-amber-700 px-2 py-0.5 rounded-full inline-block mb-2",children:["\uD83D\uDD14 ",new Date(e.reminder_at).toLocaleDateString("ro-RO",{day:"2-digit",month:"short"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-[10px] text-gray-400",children:new Date(e.created_at).toLocaleDateString("ro-RO",{day:"2-digit",month:"short"})}),e.assignee&&(0,t.jsx)("div",{className:"w-5 h-5 rounded-full flex items-center justify-center text-[8px] font-bold text-white",style:{background:e.assignee.avatar_color},children:e.assignee.full_name.split(" ").map(e=>e[0]).join("").substring(0,2)})]}),e.phone&&(0,t.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-100 flex gap-1",children:[(0,t.jsx)("a",{href:"https://wa.me/".concat(e.phone.replace(/\D/g,"")),target:"_blank",className:"text-[10px] bg-green-50 text-green-700 px-2 py-0.5 rounded hover:bg-green-100",children:"\uD83D\uDCAC WA"}),(0,t.jsx)("a",{href:"tel:".concat(e.phone),className:"text-[10px] bg-gray-50 text-gray-600 px-2 py-0.5 rounded hover:bg-gray-100",children:"\uD83D\uDCDE"})]})]},e.id)),0===a.length&&(0,t.jsx)("div",{className:"text-center py-6 text-xs text-gray-400",children:"Niciun lead"})]}),(0,t.jsx)("button",{onClick:()=>{_(a=>({...a,status:e})),j(!0)},className:"mx-2 mb-2 py-1.5 border border-dashed border-gray-300 rounded-lg text-xs text-gray-400 hover:border-[#004437] hover:text-[#004437] transition-colors",children:"+ Adaugă"})]},e)})})}),(0,t.jsx)(c.Z,{leadId:v,onClose:()=>{w(null),p.refresh()},team:s,isAdmin:m}),f&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"font-semibold",children:"Lead nou"}),(0,t.jsx)("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-gray-600 text-xl",children:"\xd7"})]}),(0,t.jsxs)("form",{onSubmit:A,className:"px-6 py-4 space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Nume *"}),(0,t.jsx)("input",{...S("name"),placeholder:"Ion Popescu",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Companie"}),(0,t.jsx)("input",{...S("company"),placeholder:"SRL..."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Telefon"}),(0,t.jsx)("input",{...S("phone"),placeholder:"+373..."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Email"}),(0,t.jsx)("input",{...S("email"),type:"email"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Sursă"}),(0,t.jsx)("select",{...S("source"),className:"input",children:["Meta Ads","WhatsApp","Organic","Referință","Site web"].map(e=>(0,t.jsx)("option",{children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Status"}),(0,t.jsx)("select",{...S("status"),className:"input",children:o.map(e=>(0,t.jsx)("option",{children:e},e))})]}),m&&s.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Responsabil"}),(0,t.jsxs)("select",{...S("assigned_to"),className:"input",children:[(0,t.jsx)("option",{value:"",children:"— eu —"}),s.map(e=>(0,t.jsx)("option",{value:e.id,children:e.full_name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"\uD83D\uDD14 Reminder"}),(0,t.jsx)("input",{...S("reminder_at"),type:"datetime-local",className:"input"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Notă"}),(0,t.jsx)("textarea",{...S("note"),className:"input resize-none",rows:2})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>j(!1),className:"btn-ghost",children:"Anulează"}),(0,t.jsx)("button",{type:"submit",className:"btn-primary",children:"Adaugă lead"})]})]})]})})]})}}},function(e){e.O(0,[46,776,155,971,23,744],function(){return e(e.s=7326)}),_N_E=e.O()}]);