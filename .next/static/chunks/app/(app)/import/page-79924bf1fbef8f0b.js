(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[215],{6757:function(e,t,s){Promise.resolve().then(s.bind(s,2154))},2154:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var r=s(7437),a=s(2265),l=s(6474),n=s(7776);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,s(8030).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var c=s(8184),o=s(1935);let d=["Meta Ads","WhatsApp","Organic","Referință","Site web","Import"];function x(){let[e,t]=(0,a.useState)("upload"),[s,x]=(0,a.useState)([]),[m,u]=(0,a.useState)([]),[p,h]=(0,a.useState)("Import"),[f,b]=(0,a.useState)(!1),[g,v]=(0,a.useState)(!1);function y(e){if(!e.name.endsWith(".csv")){n.A.error("Doar fișiere CSV");return}let s=new FileReader;s.onload=e=>{var s;let r=function(e){let t=e.trim().split("\n").filter(Boolean);if(t.length<2)return[];let s=t[0].split(",").map(e=>e.trim().toLowerCase().replace(/"/g,""));return t.slice(1).map(e=>{let t=e.split(",").map(e=>e.trim().replace(/"/g,"")),r={};return s.forEach((e,s)=>{r[e]=t[s]||""}),{name:r.name||r.nume||"",company:r.company||r.companie||"",phone:r.phone||r.telefon||"",email:r.email||"",source:r.source||r.sursa||p,note:r.note||r.nota||r.notă||""}}).filter(e=>e.name)}(null===(s=e.target)||void 0===s?void 0:s.result);if(0===r.length){n.A.error("CSV invalid sau gol");return}x(r),t("preview")},s.readAsText(e)}async function j(){b(!0);let e=(0,l.e)(),{data:{user:r}}=await e.auth.getUser(),a=[];for(let t of s){let{error:s}=await e.from("leads").insert({name:t.name,company:t.company||null,phone:t.phone||null,email:t.email||null,source:d.includes(t.source||"")?t.source:"Import",note:t.note||null,status:"Nou",assigned_to:null==r?void 0:r.id,created_by:null==r?void 0:r.id});a.push({...t,ok:!s,error:null==s?void 0:s.message})}u(a),t("done"),b(!1);let i=a.filter(e=>e.ok).length,c=a.filter(e=>!e.ok).length;0===c?n.A.success("".concat(i," lead-uri importate cu succes!")):n.A.error("".concat(i," importate, ").concat(c," erori"))}return(0,r.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 h-14 flex items-center justify-between flex-shrink-0",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-base font-semibold",children:"Import lead-uri"}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:"Importă din CSV"})]}),(0,r.jsxs)("button",{onClick:function(){let e=new Blob(["name,company,phone,email,source,note\nIon Popescu,TaxFlow SRL,+37360000001,ion@taxflow.md,Meta Ads,Client nou\nMaria Ionescu,ABC SRL,+37360000002,maria@abc.md,Referință,Referit de Ion"],{type:"text/csv"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="taxflow-import-template.csv",t.click()},className:"btn-outline text-xs",children:[(0,r.jsx)(i,{size:14}),"Template CSV"]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-auto p-6",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto",children:["upload"===e&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-[#e8f0ee] border border-[#c2d9d3] rounded-xl p-4 text-sm text-[#004437]",children:[(0,r.jsx)("p",{className:"font-semibold mb-2",children:"\uD83D\uDCCB Format CSV acceptat:"}),(0,r.jsx)("code",{className:"text-xs bg-white/60 rounded px-2 py-1 block",children:"name, company, phone, email, source, note"}),(0,r.jsxs)("p",{className:"mt-2 text-xs text-[#004437]/70",children:["Coloana ",(0,r.jsx)("strong",{children:"name"})," este obligatorie. Descarcă template-ul pentru exemplu."]})]}),(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("label",{className:"label",children:"Sursă implicită (dacă lipsește din CSV)"}),(0,r.jsx)("select",{className:"input w-48",value:p,onChange:e=>h(e.target.value),children:d.map(e=>(0,r.jsx)("option",{children:e},e))})]}),(0,r.jsxs)("div",{onDragOver:e=>{e.preventDefault(),v(!0)},onDragLeave:()=>v(!1),onDrop:function(e){e.preventDefault(),v(!1);let t=e.dataTransfer.files[0];t&&y(t)},className:"border-2 border-dashed rounded-xl p-12 text-center transition-all cursor-pointer ".concat(g?"border-[#004437] bg-[#e8f0ee]":"border-gray-300 hover:border-[#004437] hover:bg-gray-50"),onClick:()=>{var e;return null===(e=document.getElementById("csvInput"))||void 0===e?void 0:e.click()},children:[(0,r.jsx)(c.Z,{size:32,className:"mx-auto text-gray-400 mb-3"}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Trage fișierul CSV aici"}),(0,r.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"sau click pentru a selecta"}),(0,r.jsx)("input",{id:"csvInput",type:"file",accept:".csv",className:"hidden",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&y(s)}})]})]}),"preview"===e&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:[s.length," lead-uri găsite"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>t("upload"),className:"btn-ghost text-xs",children:"← \xcenapoi"}),(0,r.jsx)("button",{onClick:j,disabled:f,className:"btn-primary text-xs",children:f?"Se importă...":"Importă "+s.length+" lead-uri →"})]})]}),(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:[(0,r.jsxs)("table",{className:"w-full text-xs",children:[(0,r.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsx)("tr",{children:["Nume","Companie","Telefon","Email","Sursă"].map(e=>(0,r.jsx)("th",{className:"px-3 py-2 text-left font-semibold text-gray-500",children:e},e))})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-100",children:s.slice(0,50).map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-3 py-2 font-medium text-gray-900",children:e.name}),(0,r.jsx)("td",{className:"px-3 py-2 text-gray-500",children:e.company||"—"}),(0,r.jsx)("td",{className:"px-3 py-2 text-gray-500",children:e.phone||"—"}),(0,r.jsx)("td",{className:"px-3 py-2 text-gray-500",children:e.email||"—"}),(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsx)("span",{className:"bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full",children:e.source||p})})]},t))})]}),s.length>50&&(0,r.jsxs)("div",{className:"px-4 py-2 bg-amber-50 text-xs text-amber-700 border-t border-amber-100",children:["Afișate 50 din ",s.length," r\xe2nduri. Toate vor fi importate."]})]})]}),"done"===e&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"bg-[#e8f0ee] rounded-xl p-4 text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-[#004437]",children:m.length}),(0,r.jsx)("div",{className:"text-xs text-[#004437]/70 mt-0.5",children:"Total procesate"})]}),(0,r.jsxs)("div",{className:"bg-green-50 rounded-xl p-4 text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:m.filter(e=>e.ok).length}),(0,r.jsx)("div",{className:"text-xs text-green-600/70 mt-0.5",children:"Importate cu succes"})]}),(0,r.jsxs)("div",{className:"bg-red-50 rounded-xl p-4 text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-red-500",children:m.filter(e=>!e.ok).length}),(0,r.jsx)("div",{className:"text-xs text-red-500/70 mt-0.5",children:"Erori"})]})]}),m.filter(e=>!e.ok).length>0&&(0,r.jsxs)("div",{className:"bg-white border border-red-200 rounded-xl overflow-hidden",children:[(0,r.jsx)("div",{className:"px-4 py-2 bg-red-50 border-b border-red-200 text-xs font-semibold text-red-600",children:"R\xe2nduri cu erori"}),m.filter(e=>!e.ok).map((e,t)=>(0,r.jsxs)("div",{className:"px-4 py-2 border-b border-gray-100 last:border-0 flex items-center gap-2 text-xs",children:[(0,r.jsx)(o.Z,{size:13,className:"text-red-500 flex-shrink-0"}),(0,r.jsx)("span",{className:"font-medium text-gray-800",children:e.name}),(0,r.jsx)("span",{className:"text-red-500",children:e.error})]},t))]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>{t("upload"),x([]),u([])},className:"btn-outline",children:"Import nou"}),(0,r.jsx)("a",{href:"/contacts",className:"btn-primary",children:"Mergi la Contacte →"})]})]})]})})]})}},6474:function(e,t,s){"use strict";s.d(t,{e:function(){return l}});var r=s(6038),a=s(357);function l(){return(0,r.createBrowserClient)(a.env.NEXT_PUBLIC_SUPABASE_URL,a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}},1935:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(8030).Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},8184:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(8030).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])}},function(e){e.O(0,[46,776,971,23,744],function(){return e(e.s=6757)}),_N_E=e.O()}]);