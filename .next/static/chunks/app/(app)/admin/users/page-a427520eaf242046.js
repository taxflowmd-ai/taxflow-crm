(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[387],{851:function(e,t,s){Promise.resolve().then(s.bind(s,9609))},9609:function(e,t,s){"use strict";s.d(t,{default:function(){return y}});var a=s(7437),i=s(2265),l=s(6463),r=s(7776),n=s(3267),c=s(2022),d=s(2940),x=s(933),o=s(4086),m=s(1935),h=s(6141),p=s(3274),g=s(994),u=s(2243),j=s(2558),f=s(9782),b=s(6542);function y(e){let{currentUserId:t,users:s,invitations:u}=e,j=(0,l.useRouter)(),[y,k]=(0,i.useState)(!1),[_,C]=(0,i.useState)(""),[Z,S]=(0,i.useState)("user"),[U,A]=(0,i.useState)(!1),[E,M]=(0,i.useState)(null);async function D(){if(_){A(!0);try{let e=await fetch("/api/admin/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:_,role:Z})}),t=await e.json();if(!e.ok)throw Error(t.error);r.A.success("Invitație trimisă la ".concat(_)),k(!1),C(""),j.refresh()}catch(e){r.A.error(e.message)}finally{A(!1)}}}async function T(e,t,s){M(e);try{let t=await fetch("/api/admin/users/".concat(e,"/toggle"),{method:"POST"}),a=await t.json();if(!t.ok)throw Error(a.error);r.A.success(a.is_active?"".concat(s," — cont reactivat"):"".concat(s," — cont dezactivat")),j.refresh()}catch(e){r.A.error(e.message)}finally{M(null)}}let I=s.filter(e=>e.is_active),R=s.filter(e=>!e.is_active);return(0,a.jsxs)("div",{className:"flex-1 overflow-auto",children:[(0,a.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 h-14 flex items-center justify-between flex-shrink-0",children:[(0,a.jsx)("h1",{className:"text-base font-semibold text-gray-900",children:"Echipă & Utilizatori"}),(0,a.jsxs)("button",{onClick:()=>k(!0),className:"btn-primary",children:[(0,a.jsx)(n.Z,{size:15}),"Invită utilizator"]})]}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsx)(z,{icon:(0,a.jsx)(c.Z,{size:18}),label:"Total utilizatori",value:s.length,color:"blue"}),(0,a.jsx)(z,{icon:(0,a.jsx)(d.Z,{size:18}),label:"Conturi active",value:I.length,color:"green"}),(0,a.jsx)(z,{icon:(0,a.jsx)(x.Z,{size:18}),label:"Invitații \xeen așteptare",value:u.length,color:"amber"})]}),(0,a.jsxs)("section",{children:[(0,a.jsxs)("h2",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[(0,a.jsx)(d.Z,{size:15,className:"text-green-500"}),"Utilizatori activi (",I.length,")"]}),(0,a.jsx)("div",{className:"card overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Utilizator"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Rol"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"\xcenregistrat"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Ultima autentificare"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Acțiuni"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-100",children:I.map(e=>(0,a.jsx)(N,{user:e,isSelf:e.id===t,toggling:E===e.id,onToggle:()=>T(e.id,e.is_active,e.full_name)},e.id))})]})})]}),u.length>0&&(0,a.jsxs)("section",{children:[(0,a.jsxs)("h2",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[(0,a.jsx)(x.Z,{size:15,className:"text-amber-500"}),"Invitații \xeen așteptare (",u.length,")"]}),(0,a.jsx)("div",{className:"card overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Email"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Rol"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Invitat de"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Expiră"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-100",children:u.map(e=>{var t;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{size:14,className:"text-gray-400 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.email})]})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)(v,{role:e.role})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:(null===(t=e.inviter)||void 0===t?void 0:t.full_name)||"—"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-amber-600 font-medium",children:(0,f.WU)(new Date(e.expires_at),"d MMM yyyy",{locale:b.ro})})]},e.id)})})]})})]}),R.length>0&&(0,a.jsxs)("section",{children:[(0,a.jsxs)("h2",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[(0,a.jsx)(m.Z,{size:15,className:"text-red-400"}),"Conturi dezactivate (",R.length,")"]}),(0,a.jsx)("div",{className:"card overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Utilizator"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Rol"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"\xcenregistrat"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Acțiuni"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-100 opacity-60",children:R.map(e=>(0,a.jsx)(N,{user:e,isSelf:!1,toggling:E===e.id,onToggle:()=>T(e.id,e.is_active,e.full_name)},e.id))})]})})]})]}),y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-6 py-5 border-b border-gray-200 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-base font-semibold",children:"Invită utilizator nou"}),(0,a.jsx)("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-gray-600 text-xl",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"px-6 py-5 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Email *"}),(0,a.jsx)("input",{type:"email",className:"input",placeholder:"maria@taxflow.md",value:_,onChange:e=>C(e.target.value),autoFocus:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Rol *"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-1",children:[(0,a.jsx)(w,{value:"user",selected:"user"===Z,onClick:()=>S("user"),icon:(0,a.jsx)(c.Z,{size:18}),label:"Utilizator",desc:"Vede doar lead-urile proprii"}),(0,a.jsx)(w,{value:"admin",selected:"admin"===Z,onClick:()=>S("admin"),icon:(0,a.jsx)(h.Z,{size:18}),label:"Administrator",desc:"Acces complet + gestionare echipă"})]})]}),(0,a.jsxs)("div",{className:"bg-[#e8f0ee] rounded-lg p-3 text-xs text-[#004437]",children:[(0,a.jsx)("p",{className:"font-medium mb-1",children:"\uD83D\uDCE7 Ce se \xeent\xe2mplă:"}),(0,a.jsxs)("ol",{className:"space-y-1 list-decimal list-inside text-[#004437]/80",children:[(0,a.jsx)("li",{children:"Se trimite un email cu link de \xeenregistrare"}),(0,a.jsx)("li",{children:"Link-ul expiră \xeen 7 zile"}),(0,a.jsx)("li",{children:"Utilizatorul setează parola și are acces imediat"})]})]})]}),(0,a.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:()=>k(!1),className:"btn-ghost",children:"Anulează"}),(0,a.jsxs)("button",{onClick:D,disabled:U||!_,className:"btn-primary",children:[U?(0,a.jsx)(p.Z,{size:14,className:"animate-spin"}):(0,a.jsx)(g.Z,{size:14}),U?"Se trimite...":"Trimite invitația"]})]})]})})]})}function N(e){let{user:t,isSelf:s,toggling:i,onToggle:l}=e,r=t.full_name.split(" ").map(e=>e[0]).join("").substring(0,2).toUpperCase();return(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white flex-shrink-0",style:{background:t.avatar_color},children:r}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900 flex items-center gap-1.5",children:[t.full_name,s&&(0,a.jsx)("span",{className:"text-[10px] bg-gray-100 text-gray-500 px-1.5 py-0.5 rounded-full",children:"tu"})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:t.email})]})]})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)(v,{role:t.role})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:(0,f.WU)(new Date(t.created_at),"d MMM yyyy",{locale:b.ro})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.last_login_at?(0,f.WU)(new Date(t.last_login_at),"d MMM \xb7 HH:mm",{locale:b.ro}):(0,a.jsx)("span",{className:"text-gray-400",children:"Niciodată"})}),(0,a.jsx)("td",{className:"px-4 py-3",children:!s&&(0,a.jsxs)("button",{onClick:l,disabled:i,className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors ".concat(t.is_active?"bg-red-50 text-red-600 hover:bg-red-100":"bg-green-50 text-green-700 hover:bg-green-100"),children:[i?(0,a.jsx)(p.Z,{size:12,className:"animate-spin"}):t.is_active?(0,a.jsx)(u.Z,{size:12}):(0,a.jsx)(j.Z,{size:12}),t.is_active?"Dezactivează":"Reactivează"]})})]})}function v(e){let{role:t}=e;return"admin"===t?(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-[#e8f0ee] text-[#004437]",children:[(0,a.jsx)(h.Z,{size:11})," Administrator"]}):(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700",children:[(0,a.jsx)(c.Z,{size:11})," Utilizator"]})}function w(e){let{value:t,selected:s,onClick:i,icon:l,label:r,desc:n}=e;return(0,a.jsxs)("button",{type:"button",onClick:i,className:"p-3 rounded-xl border-2 text-left transition-all ".concat(s?"border-[#004437] bg-[#e8f0ee]":"border-gray-200 hover:border-gray-300"),children:[(0,a.jsx)("div",{className:"mb-1 ".concat(s?"text-[#004437]":"text-gray-500"),children:l}),(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:r}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-0.5 leading-snug",children:n})]})}function z(e){let{icon:t,label:s,value:i,color:l}=e;return(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("div",{className:"inline-flex p-2 rounded-lg ".concat({blue:"bg-blue-50 text-blue-600",green:"bg-[#e8f0ee] text-[#004437]",amber:"bg-amber-50 text-amber-600"}[l]," mb-3"),children:t}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900 font-serif",children:i}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:s})]})}}},function(e){e.O(0,[46,648,971,23,744],function(){return e(e.s=851)}),_N_E=e.O()}]);