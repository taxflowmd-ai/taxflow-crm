(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[325],{3734:function(e,t,a){Promise.resolve().then(a.bind(a,3812))},3812:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var r=a(7437),i=a(2265),s=a(6474),n=a(7776),l=a(2513),c=a(374);/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,a(8030).Z)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var u=a(6706),o=a(883);let x=[{id:"all",label:"Toate"},{id:"today",label:"Azi"},{id:"overdue",label:"Expirate"},{id:"pending",label:"Active"},{id:"recurring",label:"Recurente"},{id:"done",label:"Finalizate"}],m={high:{label:"\xcenaltă",cls:"bg-red-50 text-red-600"},medium:{label:"Medie",cls:"bg-amber-50 text-amber-600"},low:{label:"Scăzută",cls:"bg-green-50 text-green-700"}},h={daily:"Zilnic",weekly:"Săptăm\xe2nal",monthly:"Lunar",quarterly:"Trimestrial",yearly:"Anual"},p={daily:864e5,weekly:6048e5,monthly:2592e6,quarterly:78624e5,yearly:31536e6};function _(){let[e,t]=(0,i.useState)([]),[a,_]=(0,i.useState)([]),[g,f]=(0,i.useState)("all"),[y,b]=(0,i.useState)(!1),[j,v]=(0,i.useState)(!0),[N,w]=(0,i.useState)([]),[D,k]=(0,i.useState)(!1),[S,C]=(0,i.useState)({title:"",lead_id:"",priority:"medium",due_at:"",reminder_at:"",assigned_to:"",is_recurring:!1,recurrence:"weekly",recurrence_end_at:""});async function A(){let e=(0,s.e)(),{data:{user:a}}=await e.auth.getUser(),{data:r}=await e.from("profiles").select("role").eq("id",a.id).single(),i=(null==r?void 0:r.role)==="admin";k(i);let{data:n}=await e.from("tasks").select("*, lead:lead_id(name), assignee:assigned_to(full_name,avatar_color)").order("due_at",{ascending:!0}),{data:l}=await e.from("leads").select("id,name").order("name"),{data:c}=i?await e.from("profiles").select("id,full_name,avatar_color").eq("is_active",!0):{data:[]};t(n||[]),_(l||[]),w(c||[]),v(!1)}(0,i.useEffect)(()=>{A()},[]);let Z=new Date,z=new Date;z.setHours(0,0,0,0);let E=new Date;E.setHours(23,59,59,999);let M=e.filter(e=>"done"===g?e.is_done:"pending"===g?!e.is_done:"recurring"===g?e.is_recurring:"overdue"===g?!e.is_done&&e.due_at&&new Date(e.due_at)<Z:"today"!==g||!e.is_done&&e.due_at&&new Date(e.due_at)>=z&&new Date(e.due_at)<=E);async function q(e,a,r){let i=(0,s.e)();if(await i.from("tasks").update({is_done:!a,done_at:a?null:new Date().toISOString()}).eq("id",e),!a&&r.is_recurring&&r.recurrence&&r.due_at){let e=new Date(new Date(r.due_at).getTime()+p[r.recurrence]),t=r.recurrence_end_at?new Date(r.recurrence_end_at):null;!t||e<=t?(await i.from("tasks").insert({title:r.title,lead_id:r.lead_id,priority:r.priority,due_at:e.toISOString(),reminder_at:r.reminder_at,assigned_to:r.assigned_to,created_by:r.created_by,is_recurring:!0,recurrence:r.recurrence,recurrence_end_at:r.recurrence_end_at,parent_task_id:r.parent_task_id||r.id}),n.A.success("Sarcină finalizată → următoarea a fost creată automat \uD83D\uDD04")):n.A.success("Sarcină finalizată — ciclu recurent \xeencheiat")}else t(t=>t.map(t=>t.id===e?{...t,is_done:!a}:t));A()}async function L(e){let a=(0,s.e)();await a.from("tasks").delete().eq("id",e),t(t=>t.filter(t=>t.id!==e)),n.A.success("Sarcină ștearsă")}async function R(e){e.preventDefault();let t=(0,s.e)(),{data:{user:a}}=await t.auth.getUser(),r={title:S.title,lead_id:S.lead_id||null,priority:S.priority,due_at:S.due_at||null,reminder_at:S.reminder_at||null,assigned_to:S.assigned_to||(null==a?void 0:a.id),created_by:null==a?void 0:a.id,is_recurring:S.is_recurring,recurrence:S.is_recurring?S.recurrence:null,recurrence_end_at:S.is_recurring&&S.recurrence_end_at?S.recurrence_end_at:null},{error:i}=await t.from("tasks").insert(r);if(i){n.A.error(i.message);return}n.A.success("Sarcină adăugată"),b(!1),C({title:"",lead_id:"",priority:"medium",due_at:"",reminder_at:"",assigned_to:"",is_recurring:!1,recurrence:"weekly",recurrence_end_at:""}),A()}let T=e=>({value:S[e],onChange:t=>C(a=>({...a,[e]:t.target.value})),className:"input"}),O=e.filter(e=>e.is_recurring&&!e.is_done).length;return(0,r.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 h-14 flex items-center justify-between flex-shrink-0",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-base font-semibold",children:"Sarcini"}),(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:[e.filter(e=>!e.is_done).length," active",O>0&&(0,r.jsxs)("span",{className:"ml-2 text-[#004437]",children:["\xb7 ",O," recurente"]})]})]}),(0,r.jsxs)("button",{onClick:()=>b(!0),className:"btn-primary",children:[(0,r.jsx)(l.Z,{size:15}),"Sarcină nouă"]})]}),(0,r.jsx)("div",{className:"bg-white border-b border-gray-100 px-6 py-2 flex gap-2 flex-shrink-0 overflow-x-auto",children:x.map(e=>(0,r.jsxs)("button",{onClick:()=>f(e.id),className:"px-3 py-1 rounded-full text-xs font-medium border transition-all whitespace-nowrap ".concat(g===e.id?"bg-[#004437] text-white border-[#004437]":"border-gray-200 text-gray-600 hover:border-gray-300"),children:[e.label,"recurring"===e.id&&O>0&&(0,r.jsx)("span",{className:"ml-1.5 bg-[#00c48c] text-white text-[9px] px-1.5 py-0.5 rounded-full",children:O})]},e.id))}),(0,r.jsx)("div",{className:"flex-1 overflow-auto p-6",children:j?(0,r.jsx)("div",{className:"text-center py-16 text-gray-400 text-sm",children:"Se \xeencarcă..."}):(0,r.jsxs)("div",{className:"space-y-2 max-w-3xl",children:[M.map(e=>{let t=!e.is_done&&e.due_at&&new Date(e.due_at)<Z,a=e.due_at&&new Date(e.due_at)>=z&&new Date(e.due_at)<=E,i=m[e.priority]||m.medium;return(0,r.jsxs)("div",{className:"bg-white border rounded-xl p-4 flex items-start gap-3 shadow-sm hover:shadow-md transition-all ".concat(e.is_done?"opacity-50":"border-gray-200"," ").concat(e.is_recurring&&!e.is_done?"border-l-4 border-l-[#004437]":""),children:[(0,r.jsx)("button",{onClick:()=>q(e.id,e.is_done,e),className:"mt-0.5 flex-shrink-0 text-gray-400 hover:text-[#004437] transition-colors",children:e.is_done?(0,r.jsx)(c.Z,{size:18,className:"text-[#00c48c]"}):(0,r.jsx)(d,{size:18})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"text-sm font-medium text-gray-900 flex items-center gap-2 ".concat(e.is_done?"line-through text-gray-400":""),children:[e.title,e.is_recurring&&(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 text-[10px] font-semibold bg-[#e8f0ee] text-[#004437] px-2 py-0.5 rounded-full flex-shrink-0",children:[(0,r.jsx)(u.Z,{size:9}),h[e.recurrence]||e.recurrence]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1.5 flex-wrap",children:[e.lead&&(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["\uD83D\uDC64 ",e.lead.name]}),(0,r.jsx)("span",{className:"text-xs font-medium px-2 py-0.5 rounded-full ".concat(i.cls),children:i.label}),e.due_at&&(0,r.jsxs)("span",{className:"text-xs font-medium ".concat(t?"text-red-500":a?"text-amber-600":"text-gray-400"),children:["\uD83D\uDCC5 ",t?"⚠ ":"",new Date(e.due_at).toLocaleDateString("ro-RO",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})]}),e.recurrence_end_at&&(0,r.jsxs)("span",{className:"text-[10px] text-gray-400",children:["p\xe2nă ",new Date(e.recurrence_end_at).toLocaleDateString("ro-RO",{day:"2-digit",month:"short",year:"numeric"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.assignee&&(0,r.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-[9px] font-bold text-white",style:{background:e.assignee.avatar_color},title:e.assignee.full_name,children:e.assignee.full_name.split(" ").map(e=>e[0]).join("").substring(0,2)}),(0,r.jsx)("button",{onClick:()=>L(e.id),className:"text-gray-300 hover:text-red-500 transition-colors",children:(0,r.jsx)(o.Z,{size:14})})]})]},e.id)}),0===M.length&&(0,r.jsxs)("div",{className:"text-center py-16 text-gray-400",children:[(0,r.jsx)("div",{className:"text-3xl mb-2",children:"✅"}),(0,r.jsx)("p",{className:"text-sm",children:"Nicio sarcină"})]})]})}),y&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"font-semibold",children:"Sarcină nouă"}),(0,r.jsx)("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600 text-xl",children:"\xd7"})]}),(0,r.jsxs)("form",{onSubmit:R,className:"px-6 py-4 space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label",children:"Titlu *"}),(0,r.jsx)("input",{...T("title"),required:!0,placeholder:"Sună clientul, trimite oferta..."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label",children:"Contact"}),(0,r.jsxs)("select",{...T("lead_id"),className:"input",children:[(0,r.jsx)("option",{value:"",children:"— niciun contact —"}),a.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label",children:"Prioritate"}),(0,r.jsxs)("select",{...T("priority"),className:"input",children:[(0,r.jsx)("option",{value:"high",children:"\uD83D\uDD34 \xcenaltă"}),(0,r.jsx)("option",{value:"medium",children:"\uD83D\uDFE1 Medie"}),(0,r.jsx)("option",{value:"low",children:"\uD83D\uDFE2 Scăzută"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label",children:"Deadline"}),(0,r.jsx)("input",{...T("due_at"),type:"datetime-local"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label",children:"\uD83D\uDD14 Reminder"}),(0,r.jsx)("input",{...T("reminder_at"),type:"datetime-local"})]}),D&&N.length>0&&(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("label",{className:"label",children:"Responsabil"}),(0,r.jsxs)("select",{...T("assigned_to"),className:"input",children:[(0,r.jsx)("option",{value:"",children:"— eu —"}),N.map(e=>(0,r.jsx)("option",{value:e.id,children:e.full_name},e.id))]})]})]}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-xl p-3 space-y-3",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2.5 cursor-pointer",children:[(0,r.jsx)("div",{onClick:()=>C(e=>({...e,is_recurring:!e.is_recurring})),className:"w-10 h-5 rounded-full transition-colors relative flex-shrink-0 ".concat(S.is_recurring?"bg-[#004437]":"bg-gray-300"),children:(0,r.jsx)("div",{className:"absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform ".concat(S.is_recurring?"translate-x-5":"translate-x-0.5")})}),(0,r.jsxs)("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-1.5",children:[(0,r.jsx)(u.Z,{size:14,className:"text-[#004437]"}),"Sarcină recurentă"]})]}),S.is_recurring&&(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 pt-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label",children:"Recurență"}),(0,r.jsxs)("select",{...T("recurrence"),className:"input",children:[(0,r.jsx)("option",{value:"daily",children:"\uD83D\uDCC5 Zilnic"}),(0,r.jsx)("option",{value:"weekly",children:"\uD83D\uDCC5 Săptăm\xe2nal"}),(0,r.jsx)("option",{value:"monthly",children:"\uD83D\uDCC5 Lunar"}),(0,r.jsx)("option",{value:"quarterly",children:"\uD83D\uDCC5 Trimestrial"}),(0,r.jsx)("option",{value:"yearly",children:"\uD83D\uDCC5 Anual"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"label",children:"Se termină la"}),(0,r.jsx)("input",{...T("recurrence_end_at"),type:"date",placeholder:"opțional"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>b(!1),className:"btn-ghost",children:"Anulează"}),(0,r.jsx)("button",{type:"submit",className:"btn-primary",children:"Adaugă"})]})]})]})})]})}},6474:function(e,t,a){"use strict";a.d(t,{e:function(){return s}});var r=a(6038),i=a(357);function s(){return(0,r.createBrowserClient)(i.env.NEXT_PUBLIC_SUPABASE_URL,i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY)}},2513:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(8030).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},6706:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(8030).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},374:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(8030).Z)("SquareCheckBig",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]])},883:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,a(8030).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[46,776,971,23,744],function(){return e(e.s=3734)}),_N_E=e.O()}]);